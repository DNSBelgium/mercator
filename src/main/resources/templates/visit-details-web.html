<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">

<head>
    <title>Mercator | Details</title>
</head>

<body>

<main class="container" layout:fragment="content">
    <h2 th:if="${webCrawlResult == null}">
        No web crawl result found for visitId
    </h2>
    <div class="container-fluid" th:if="${webCrawlResult != null}">
        <header>
            <h4 th:text="${webCrawlResult.domainName}"></h4>
        </header>

        <table>
            <tbody>
            <tr>
                <th>visitId</th>
                <td th:text="${webCrawlResult.visitId}"></td>
            </tr>
            <tr>
                <th style="width: 30em">Started</th>
                <td th:text="${webCrawlResult.crawlStarted}"></td>
            </tr>
            <tr>
                <th>Finished</th>
                <td th:text="${webCrawlResult.crawlFinished}"></td>
            </tr>
            <tr>
                <th>Start URL</th>
                <td th:text="${webCrawlResult.startUrl}"></td>
            </tr>
            <tr>
                <th>Matching URL</th>
                <td th:text="${webCrawlResult.matchingUrl}"></td>

            </tr>
            <tr>
                <th>VAT values</th>
                <td>
                    <span th:if="${#lists.isEmpty(webCrawlResult.getVatValues())}">No VAT Values found</span>
                    <details th:if="${!#lists.isEmpty(webCrawlResult.getVatValues())}">
                        <summary>Click to show VAT values</summary>
                        <ul>
                            <li th:each="vatValue : ${webCrawlResult.getVatValues()}">
                                <a th:href="'https://kbopub.economie.fgov.be/kbopub/zoeknummerform.html?nummer=' + ${#strings.substring(vatValue, 2)}"
                                   th:text="'BE' + ${#strings.substring(vatValue, 2)}"></a>
                            </li>
                        </ul>
                    </details>
                </td>
            </tr>
            <tr>
                <td>Detected Technologies</td>
                <td>
                    <span th:if="${webCrawlResult.getDetectedTechnologies().isEmpty()}">No Technologies detected</span>
                    <details th:if="${!webCrawlResult.getDetectedTechnologies().isEmpty()}">
                        <summary>Click to show detected technologies</summary>
                        <ul>
                            <li th:each="detectedTechnology : ${webCrawlResult.getDetectedTechnologies()}">
                                <p th:text="${detectedTechnology}"></p>
                            </li>
                        </ul>
                    </details>
                </td>
            </tr>
            <tr>
                <th>Number of visited URLs</th>
                <td th:text="${webCrawlResult.visitedUrls.size()}"></td>
            </tr>
            <tr>
                <th>Number of pages with html features</th>
                <td th:text="${webCrawlResult.htmlFeatures.size()}"></td>
            </tr>
            <tr>
                <th>Visited URLs</th>
                <td>
                    <span th:if="${webCrawlResult.getVisitedUrls().isEmpty()}">No visited URLs</span>
                    <details th:if="${!webCrawlResult.getVisitedUrls().isEmpty()}">
                        <summary>Click to show visited URLs</summary>
                        <ul>
                            <li th:each="visitedUrl : ${webCrawlResult.visitedUrls}">
                                <span th:text="${visitedUrl}"></span>
                            </li>
                        </ul>
                    </details>
                </td>
            </tr>
            <tr>
                <th>Page visits</th>
                <td th:if="${webCrawlResult.pageVisits.isEmpty()}">No Page visits</td>
                <td>
                    <details th:if="${not webCrawlResult.pageVisits.isEmpty()}">
                        <summary>Click to show page visits</summary>
                        <div th:each="pageVisit, iterStat : ${webCrawlResult.getPageVisits()}">
                            <h4>Pagevisit #[[${iterStat.count}]]</h4>
                            <table>
                                <tbody>
                                <tr>
                                    <th>URL</th>
                                    <td th:text="${pageVisit.url}"></td>
                                </tr>
                                <tr>
                                    <th>path</th>
                                    <td th:text="${pageVisit.path}"></td>
                                </tr>
                                <tr>
                                    <th>crawlStarted</th>
                                    <td th:text="${pageVisit.crawlStarted}"></td>
                                </tr>
                                <tr>
                                    <th>crawlFinished</th>
                                    <td th:text="${pageVisit.crawlFinished}"></td>
                                </tr>
                                <tr>
                                    <th>statusCode</th>
                                    <td th:text="${pageVisit.statusCode}"></td>
                                </tr>
                                <tr>
                                    <td>
                                        HTTP response body
                                    </td>
                                    <!--  TODO: ask which method to use for raw html, on same page or new page?
                                    <td th:if="${not #strings.isEmpty(pageVisit.getResponseBody())}">
                                        <details>
                                            <summary>Click to see HTTP response body</summary>
                                            <pre th:utext="${#strings.replace(pageVisit.getResponseBody(), '\n', '<br/>')}"></pre>
                                        </details>
                                    </td>
                                    -->
                                    <td>
                                        <script>
                                            function renderRawHtml(html) {
                                                const newWindow = window.open();
                                                newWindow.document.title = 'raw html'
                                                const pre = newWindow.document.createElement("pre");
                                                pre.textContent = html;
                                                newWindow.document.body.appendChild(pre);
                                            }

                                            function openHtmlInNewTab(htmlContent) {
                                                const newWindow = window.open();
                                                newWindow.document.write(htmlContent);
                                                newWindow.document.close();
                                            }
                                        </script>
                                        <button th:data-html="${pageVisit.getResponseBody()}" onclick="renderRawHtml(this.getAttribute('data-html'))">Go to raw html</button>
                                        <button th:data-html="${pageVisit.getResponseBody()}" onclick="openHtmlInNewTab(this.getAttribute('data-html'))">View in browser</button>
                                    </td>
                                </tr>
                                <tr>
                                    <th>URL</th>
                                    <td th:text="${pageVisit.linkText}"></td>
                                </tr>
                                <tr>
                                    <td>VAT values</td>
                                    <td>
                                        <span th:if="${pageVisit.getVatValues().isEmpty()}">No VAT values found</span>
                                        <details th:if="${!pageVisit.getVatValues().isEmpty()}">
                                            <summary>Click to show VAT values</summary>
                                            <ul>
                                                <li th:each="vatValue : ${pageVisit.getVatValues()}">
                                                    <a th:href="'https://kbopub.economie.fgov.be/kbopub/zoeknummerform.html?nummer=' + ${#strings.substring(vatValue, 2)}"
                                                       th:text="'BE' + ${#strings.substring(vatValue, 2)}"></a>
                                                </li>
                                            </ul>
                                        </details>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        headers
                                    </td>
                                    <td>
                                        <span th:if="${pageVisit.getHeaders() == null}">No headers found</span>
                                        <details th:if="${pageVisit.getHeaders() != null}">
                                            <summary>Click to show headers</summary>
                                            <ul>
                                                <li th:each="header : ${pageVisit.getHeaders()}">
                                                    <p th:text="${header}"></p>
                                                </li>
                                            </ul>
                                        </details>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Content Length</td>
                                    <td th:text="${pageVisit.getContentLength()}"></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </details>
                </td>
            </tr>
            </tbody>
        </table>
        <div th:each="features : ${webCrawlResult.getHtmlFeatures()}">
            <header>
                <h5 th:text="${features.domainName}"></h5>
            </header>

            <table>
                <thead></thead>
                <tbody>
                <tr>
                    <td style="width: 30em">url</td>
                    <td th:text="${features.url}"></td>
                </tr>
                <tr>
                    <td>title</td>
                    <td th:text="${features.title}"></td>
                </tr>
                <tr>
                    <td>Meta text</td>
                    <td th:text="${features.meta_text}"></td>
                </tr>
                <tr>
                    <td>features body text</td>
                    <td>
                        <span th:if="${#strings.isEmpty(features.body_text)}">No body text found</span>
                        <details th:if="${!#strings.isEmpty(features.body_text)}">
                            <summary>click to show features body text</summary>
                            <p th:utext="${#strings.replace(features.body_text, '\n', '<br/>')}"></p>
                        </details>
                    </td>

                </tr>
                <tr>
                    <td>nb_images</td>
                    <td th:text="${features.nb_imgs}"></td>
                </tr>
                <tr>
                    <td>Internal links</td>
                    <td th:text="${features.nb_links_int}"></td>
                </tr>
                <tr>
                    <td>External links</td>
                    <td th:text="${features.nb_links_ext}"></td>
                </tr>
                <tr>
                    <td>Email links</td>
                    <td th:text="${features.nb_links_email}"></td>
                </tr>
                <tr>
                    <td>Telephone links</td>
                    <td th:text="${features.nb_links_tel}"></td>
                </tr>
                <tr>
                    <td>Inputs of type txt</td>
                    <td th:text="${features.nb_input_txt}"></td>
                </tr>
                <tr>
                    <td>Buttons</td>
                    <td th:text="${features.nb_button}"></td>
                </tr>
                <tr>
                    <td>Meta desriptions</td>
                    <td th:text="${features.nb_meta_desc}"></td>
                </tr>
                <tr>
                    <td>Meta keywords</td>
                    <td th:text="${features.nb_meta_keyw}"></td>
                </tr>
                <tr>
                    <td>Numerical strings</td>
                    <td th:text="${features.nb_numerical_strings}"></td>
                </tr>
                <tr>
                    <td>Tags</td>
                    <td th:text="${features.nb_tags}"></td>
                </tr>
                <tr>
                    <td>Words</td>
                    <td th:text="${features.nb_words}"></td>
                </tr>
                <tr>
                    <td>Letters</td>
                    <td th:text="${features.nb_letters}"></td>
                </tr>
                <tr>
                    <td>Number of facebook shallow links</td>
                    <td th:text="${features.nb_facebook_shallow_links}"></td>
                </tr>
                <tr>
                    <td>Number of facebook deep links</td>
                    <td th:text="${features.nb_facebook_deep_links}"></td>
                </tr>
                <tr>
                    <td>Number of Twitter shallow links</td>
                    <td th:text="${features.nb_twitter_shallow_links}"></td>
                </tr>
                <tr>
                    <td>Number of Twitter deep links</td>
                    <td th:text="${features.nb_twitter_deep_links}"></td>
                </tr>
                <tr>
                    <td>Number of LinkedIn shallow links</td>
                    <td th:text="${features.nb_linkedin_shallow_links}"></td>
                </tr>
                <tr>
                    <td>Number of LinkedIn deep links</td>
                    <td th:text="${features.nb_linkedin_deep_links}"></td>
                </tr>
                <tr>
                    <td>Number of YouTube shallow links</td>
                    <td th:text="${features.nb_youtube_shallow_links}"></td>
                </tr>
                <tr>
                    <td>Number of YouTube deep links</td>
                    <td th:text="${features.nb_youtube_deep_links}"></td>
                </tr>
                <tr>
                    <td>Number of Vimeo shallow links</td>
                    <td th:text="${features.nb_vimeo_shallow_links}"></td>
                </tr>
                <tr>
                    <td>Number of Vimeo deep links</td>
                    <td th:text="${features.nb_vimeo_deep_links}"></td>
                </tr>
                <tr>
                    <td>Number of currency names</td>
                    <td th:text="${features.nb_currency_names}"></td>
                </tr>
                <tr>
                    <td>Distinct currencies</td>
                    <td th:text="${features.nb_distinct_currencies}"></td>
                </tr>
                <tr>
                    <td>Distance between title and domainName in initial url</td>
                    <td th:text="${features.distance_title_initial_dn}"></td>
                </tr>
                <tr>
                    <td>Distance between title and domainName in final url</td>
                    <td th:text="${features.distance_title_final_dn}"></td>
                </tr>
                <tr>
                    <td>Longest subsequence between title and domainName in initial url</td>
                    <td th:text="${features.longest_subsequence_title_initial_dn}"></td>
                </tr>
                <tr>
                    <td>Longest subsequence between title and domainName in final url</td>
                    <td th:text="${features.longest_subsequence_title_final_dn}"></td>
                </tr>
                <tr>
                    <td>Fraction between title and domainName in initial url</td>
                    <td th:text="${features.fraction_words_title_initial_dn}"></td>
                </tr>
                <tr>
                    <td>Fraction subsequence between title and domainName in final url</td>
                    <td th:text="${features.fraction_words_title_final_dn}"></td>
                </tr>
                <tr>
                    <td>Distinct words in title</td>
                    <td th:text="${features.nb_distinct_words_in_title}"></td>
                </tr>
                <tr>
                    <td>Distinct hosts in url's</td>
                    <td th:text="${features.nb_distinct_hosts_in_urls}"></td>
                </tr>
                <tr>
                    <td>Language</td>
                    <td th:text="${features.body_text_language}"></td>
                </tr>
                <tr>
                    <td>Language</td>
                    <td th:text="${features.body_text_language_2}"></td>
                </tr>
                <tr>
                    <td>External hosts</td>
                    <td>
                        <span th:if="${#lists.isEmpty(features.external_hosts)}">No external hosts found</span>
                        <details th:if="${!#lists.isEmpty(features.external_hosts)}">
                            <summary>Click to show external hosts</summary>
                            <ul>
                                <li th:each="host : ${features.external_hosts}">
                                    <span th:text="${host}"></span>
                                </li>
                            </ul>
                        </details>
                    </td>
                </tr>
                <tr>
                    <td>Facebook links</td>
                    <td>
                        <span th:if="${features.facebook_links.isEmpty()}">
                          No Facebook links found
                        </span>
                        <details th:if="${!features.facebook_links.isEmpty()}">
                            <summary>Click to show Facebook links</summary>
                            <ul>
                                <li th:each="link: ${features.facebook_links}">
                                    <span th:text="${link}"></span>
                                </li>
                            </ul>
                        </details>
                    </td>
                </tr>
                <tr>
                    <td>Twitter links</td>
                    <td>
                        <span th:if="${features.twitter_links.isEmpty()}">
                          No Twitter links found
                        </span>
                        <details th:if="${!features.twitter_links.isEmpty()}">
                            <summary>Click to show Twitter links</summary>
                            <ul>
                                <li th:each="link: ${features.twitter_links}">
                                    <span th:text="${link}"></span>
                                </li>
                            </ul>
                        </details>
                    </td>
                </tr>
                <tr>
                    <td>YouTube links</td>
                    <td>
                        <span th:if="${#lists.isEmpty(features.youtube_links)}">No Youtube links found</span>
                        <details th:if="${!#lists.isEmpty(features.youtube_links)}">
                            <summary>Click to show YouTube links</summary>
                            <ul>
                                <li th:each="link : ${features.youtube_links}">
                                    <span th:text="${link}"></span>
                                </li>
                            </ul>
                        </details>
                    </td>
                </tr>
                <tr>
                    <td>Vimeo links</td>
                    <td>
                        <span th:if="${#lists.isEmpty(features.vimeo_links)}"></span>
                        <details th:if="${!#lists.isEmpty(features.vimeo_links)}">
                            <summary>Click to show Vimeo links</summary>
                            <ul>
                                <li th:each="link : ${#strings.arraySplit(features.vimeo_links, ',')}">
                                    <span th:text="${link}"></span>
                                </li>
                            </ul>
                        </details>
                    </td>
                </tr>

                </tbody>
            </table>

        </div>

    </div>

</main>


</body>
</html>