<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">

<head>
  <title>Mercator | Details</title>
</head>

<body>

<main class="container-fluid" layout:fragment="content">
  <h2 th:if="${smtpVisitResult == null}">
    No SMTP crawl results found for visit-id <strong th:text="${visitId}"></strong>
  </h2>
  <div class="container-fluid" th:if="${smtpVisitResult != null}">
    <header>
      <h4>SMTP crawl results for: <strong th:text="${smtpVisitResult.domainName}"></strong></h4>
    </header>
    <table>
      <tbody>
      <tr>
        <th>Visit Id</th>
        <td th:text="${smtpVisitResult.visitId}"></td>
      </tr>
      <tr>
        <th>Timestamp</th>
        <td th:text="${@dateTimeUtil.format(smtpVisitResult.timestamp)}"></td>
      </tr>
      <tr>
        <th># conversations</th>
        <td th:text="${smtpVisitResult.numConversations}"></td>
      </tr>
      <tr>
        <th>Crawl status</th>
        <td th:text="${smtpVisitResult.crawlStatus}"></td>
      </tr>
      </tbody>
    </table>
    <p th:if="${smtpVisitResult.getHosts() == null or #lists.isEmpty(smtpVisitResult.getHosts())}">No hosts</p>
    <p>Hosts</p>
    <div th:each="host : ${smtpVisitResult.getHosts()}">
      <table>
        <tbody>
        <tr>
          <th>From MX</th>
          <td th:text="${host.fromMx} "></td>
        </tr>
        <tr>
          <th>Host name</th>
          <td th:text="${host.hostName}"></td>
        </tr>
        <tr>
          <th>Priority</th>
          <td th:text="${host.priority}"></td>
        </tr>
        </tbody>
      </table>
      <div th:if="${host.conversation != null}">
        <details>
          <summary>Click to show conversation with <span th:text="${host.conversation.ip}"></span></summary>
          <table th:if="${host.conversation != null}">
            <tbody>
            <tr>
              <th>IP</th>
              <td th:text="${host.conversation.ip}"></td>
            </tr>
            <tr>
              <th>ASN</th>
              <td th:text="${host.conversation.asn}"></td>
            </tr>
            <tr>
              <th>Country</th>
              <td th:text="${host.conversation.country}"></td>
            </tr>
            <tr>
              <th>ASN organisation</th>
              <td th:text="${host.conversation.asnOrganisation}"></td>
            </tr>
            <tr>
              <th>Banner</th>
              <td th:text="${host.conversation.banner}"></td>
            </tr>
            <tr>
              <th>Connect OK</th>
              <td th:text="${host.conversation.connectOK} ? 'Yes' : 'No'"></td>
            </tr>
            <tr>
              <th>Connect reply code</th>
              <td th:text="${host.conversation.connectReplyCode}"></td>
            </tr>
            <tr th:replace="~{fragments/general :: listDisplay('Supported extensions', ${host.conversation.getSupportedExtensions()}, 4)}"></tr>
            <tr>
              <th>IP version</th>
              <td th:text="${host.conversation.ipVersion}"></td>
            </tr>
            <tr>
              <th>START_TLS OK</th>
              <td th:text="${host.conversation.startTlsOk} ? 'Yes' : 'No'"></td>
            </tr>
            <tr>
              <th>START_TLS reply code</th>
              <td th:text="${host.conversation.startTlsReplyCode}"></td>
            </tr>
            <tr th:replace="~{fragments/general :: textDisplay('Error message', ${host.conversation.getErrorMessage()}, 200)}"></tr>
            <tr th:replace="~{fragments/general :: textDisplay('Error', ${host.conversation.getError()}, 200)}"></tr>
            <tr>
              <th>Connection time</th>
              <td th:text="${host.conversation.connectionTimeMs} + ' ms'"></td>
            </tr>
            <tr>
              <th>Software</th>
              <td th:text="${host.conversation.software}"></td>
            </tr>
            <tr>
              <th>Software version</th>
              <td th:text="${host.conversation.softwareVersion}"></td>
            </tr>
            <tr>
              <th>Timestamp</th>
              <td th:text="${@dateTimeUtil.format(host.conversation.timestamp)}"></td>
            </tr>
            </tbody>
          </table>
        </details>
      </div>
      <p th:if="${host.conversation == null}">No conversation</p>
    </div>
  </div>
</main>
</body>
</html>